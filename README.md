# reaction-docs

üìù `reaction-docs` is the new static documentation generator for all Reaction Commerce projects.

## Requirements

- Node, 6.x and above
- Yarn
- Docker

## Stack

- [Docusaurus](https://github.com/facebook/docusaurus/), for static-site documentation generation
- Markdown for Docs
- React for components
- [highlight.js](https://github.com/isagalaev/highlight.js) for JavaScript, HTML, CSS, shell syntax highlighting
- [Prism.js](https://prismjs.com/) for JSX, GraphQL syntax highlighting
- [Algolia DocSearch](https://community.algolia.com/docsearch/)
- ESLint configured with Reaction Commerce eslint config
- LiveReload during development
- Docker

## Getting started contributing docs

### Run the app locally

```
git clone git@github.com:reactioncommerce/reaction-docs.git
cd reaction-docs
bin/setup
docker-compose up
```

Open `localhost:4242`

### Update existing documentation

To update docs for the current released version of Reaction, edit existing Markdown files in `website/versioned_docs`.

1. Find the Markdown file you want to edit in the latest version's folder, at `website/versioned_docs/version-CURRENTVERSION`. If the document you want to edit is not in that folder, check in previous versions' folders until you find the latest one.
1. Edit the file and save.
1. Go to `localhost:4242/docs/<YOURMARKDOWNFILE_ID>` to see your changes locally.

## Documenting unreleased features, changes

To update docs of unreleased features, you will need to edit existing Markdown files in `public_docs`. For example, if you are documenting *upcoming* Reaction API changes to Cart that are merged into `develop`, but not yet in `master`, you'd update the `public-docs/cart.md` file.

1. Edit the file and save.
1. Go to `localhost:4242/docs/next/<YOURMARKDOWNFILE_ID>` to see your changes locally.

## Documenting new, unreleased features

To create brand new documentation files for unreleased code that has previously not been documented, you will need to create *new* files in `public_docs`:

1. At the start of the file, add the required frontmatter:
```md
---
id: doc2
title: document number 2
---
```
1. Add the Markdown file to the table of contents, at `website/sidebars.json`.
1. When you update `sidebars.json`, you'll need to restart the app to see changes. Restart the app.
1. Go to `localhost:4242/docs/next/<YOURMARKDOWNFILE_ID>` to see your new file locally.

### Tips for documenting

- To add images, save the image in website/static/assets and reference it like this:

```md
![](/assets/admin-dashboard.png "Reaction Dashboard")
```

- To link to other articles, reference other articles by their filename:

```md
Refer to the [FAQs](faqs.md) article
```

- To enable code syntax highlighting, add `js`, `jsx`, `graphql`, `html`, `sh`, `git`, `yaml` and [more](https://github.com/reactioncommerce/reaction-docs-static/issues/47) after the ```.

- For more Markdown features, including autogenerated table of contents, refer to [Docusaurus docs](https://docusaurus.io/docs/en/doc-markdown.html).

### Sign your commits

Developer Certificate of Origin

We use the Developer Certificate of Origin (DCO) in lieu of a Contributor License Agreement for all contributions to Reaction Commerce open source projects. We request that contributors agree to the terms of the DCO and indicate that agreement by signing all commits made to Reaction Commerce projects by adding a line with your name and email address to every Git commit message contributed:

Signed-off-by: Jane Doe <jane.doe@example.com>

You can sign your commit automatically with Git by using git commit -s if you have your user.name and user.email set as part of your Git configuration.

We ask that you use your real name (please no anonymous contributions or pseudonyms). By signing your commit you are certifying that you have the right to submit it under the open source license used by that particular Reaction Commerce project. You must use your real name (no pseudonyms or anonymous contributions are allowed.)

We use the Probot DCO GitHub app to check for DCO signoffs of every commit.

If you forget to sign your commits, the DCO bot will remind you and give you detailed instructions for how to amend your commits to add a signature.

## Developing

The Header, Footer, index page and version pages are developed in React and CSS within the `website/core` and `website/static` directories. Site configuration details are managed in `website/siteConfig.js`.

### Logging

```sh
docker-compose up -d && docker-compose logs -f
```

### Linting

```sh
docker-compose run --rm web yarn lint
```

```sh
docker-compose run --rm web yarn lint:fix:eslint
```

### Running commands

`docker-compose run --rm web [...]` will run any command inside a Docker container and then remove the container.

### Restart

```sh
docker-compose run --rm web yarn install \
&& docker-compose down --rmi local \
&& docker-compose build \
&& docker-compose up
```

### Tests

Tests are stubbed out for now.

## Versioning

Add a new version

```sh
docker-compose run --rm web yarn run version <version>
```

Rename an existing version to a new name

```sh
docker-compose run --rm web yarn run rename-version <currentVersion> <newVersion>
```

See [Versioning guide](https://docusaurus.io/docs/en/1.1.4/versioning.html) for more.

## Releasing a new version

1. Add a new version

```sh
docker-compose run --rm web yarn run version <version-number>
```

2. Restart the container:

```sh
docker-compose down && docker-compose up
```

3. Run locally to confirm the version number has been changed on `localhost:4242`, and the previous version has been added to `localhost:4242/versions` list.

4. If all things look good, push the branch up to make a pull request.

5. Merge to `master` to auto-deploy

## Deploying

### Merge to `staging` branch

Merging to `staging` will trigger a CircleCI build to https://reaction-docs-staging.reactioncommerce.com/

### Merge to `master` branch

Merging to `master` will trigger a CircleCI build to http://reaction-docs-production.netlify.com
